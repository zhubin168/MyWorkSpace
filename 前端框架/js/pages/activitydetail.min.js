"use strict";!function(){{var t={Reserve:2,Pending:3,Live:4,Replay:5,Convening:6},i={Online:1,OnlineOffline:2,Offline:3};new Vue({el:"#contentBody",data:function(){return{activityStateConst:t,joinWayConst:i,activityId:jhbActivityDetailConfig.id,activityType:jhbActivityDetailConfig.activityType,activity:{IsActivity:!0,Unit:{}},loadActivityComplete:!1,joinWayOpen:!1,selectedJoinWay:null,unitOpen:!1,unitDetail:{},enableSubmit:!1,isCommentInputFocus:!1}},computed:{isOnlineOffline:function(){return this.activity.Way===this.joinWayConst.OnlineOffline}},mixins:[jhbCore.vueMixin],created:function(){this.loadActivity()},methods:{loadActivity:function(){var t=this,i=jhbGlobal.jhbApi+"/activity/activitydetail";this.showLoading(),this.httpPost(i,{activityId:t.activityId,type:t.activityType}).then(function(i){t.loadActivityComplete=!0,i.code&&i.data&&(t.activity=i.data,document.title=i.data.Title,t.initSelectedJoinWay())})},initSelectedJoinWay:function(){this.activity&&!this.activity.JoinWay&&(this.isOnlineOffline||(this.selectedJoinWay=this.activity.Way))},reserve:function(){this.isOnlineOffline?this.openReserveWayChoose():this.doReserve()},doReserve:function(t){var i=this;this.httpPost(jhbGlobal.jhbApi+"/activity/apply",{activityId:i.activityId,activityType:i.activityType,way:i.selectedJoinWay,isEverJoined:i.activity.IsEverJoined}).then(function(e){e.code?(i.activity.JoinWay=i.selectedJoinWay,i.activity.IsEverJoined?weui.toast("修改成功",1e3):(i.activity.IsEverJoined=!0,weui.alert("请按时参会，如果您不方便参会可以自行取消预约",{title:"预约成功",buttons:[{label:"知道了",type:"primary"}]}))):weui.alert(e.msg,{title:"预约失败",buttons:[{label:"知道了",type:"primary"}]}),t&&t(e)})},cacelReserve:function(){var t=this;if(t.isOnlineOffline)var i=this.activity.JoinWay===this.joinWayConst.Online,e=i?"线下":"线上",n=weui.alert("您还可以更改参会方式",{title:"是否确定取消",buttons:[{label:"改为"+e,type:"default",onClick:function(){return t.selectedJoinWay=i?t.joinWayConst.Offline:t.joinWayConst.Online,t.doReserve(function(){n.hide()}),!1}},{label:"确定取消",type:"primary",onClick:function(){t.doCancelReserve(function(){n.hide()})}}]});else var n=weui.alert("取消后可重新预约",{title:"是否确定取消",buttons:[{label:"暂不取消",type:"default"},{label:"确定取消",type:"primary",onClick:function(){t.doCancelReserve(function(){n.hide()})}}]})},doCancelReserve:function(t){var i=this;return this.httpPost(jhbGlobal.jhbApi+"/activity/cancelapply",{activityId:i.activityId,activityType:i.activityType}).then(function(e){e.code?(i.activity.IsEverJoined=!1,i.activity.JoinWay=null,i.isOnlineOffline&&(i.selectedJoinWay=null),weui.toast("取消成功",1e3),t&&t()):weui.alert(e.msg,{title:"取消预约失败",buttons:[{label:"知道了",type:"primary"}]})}),!1},changeReserveWay:function(t){this.selectedJoinWay=t,this.enableSubmit=!0},openReserveWayChoose:function(){this.joinWayOpen=!0},confirmReserve:function(){return this.selectedJoinWay?void this.doReserve(this.closeReserveWayChoose):(weui.alert("需要您选择线上或线下参会",{title:"请选择参会形式",buttons:[{label:"确定",type:"primary"}]}),!1)},closeReserveWayChoose:function(){this.joinWayOpen=!1},viewCompanyDetail:function(t){var i=this,e=jhbGlobal.jhbApi+"/unit/getunitdetail";this.httpPost(e,{unitId:t}).then(function(t){t.code&&t.data&&(i.unitDetail=t.data,i.unitOpen=!0)})},hideCompanyDetail:function(){this.unitOpen=!1},toComment:function(){this.$refs.comment.focusComment()},viewActivity:function(t,i,e){var n=this;n.httpPost(jhbGlobal.jhbApi+"/auth/checkactivityviewauth",{activityId:i,activityType:t}).then(function(a){if(a.code){var o=n.getViewUrl(t,i,e);window.location.href=o}})},handleCommentFocus:function(){this.isCommentInputFocus=!0},handleCommentBlur:function(){this.isCommentInputFocus=!1}}})}}();